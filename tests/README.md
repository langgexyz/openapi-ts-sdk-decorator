# OpenAPI TypeScript SDK Decorator æµ‹è¯•æŒ‡å—

æœ¬ç›®å½•åŒ…å« `openapi-ts-sdk-decorator` åŒ…çš„**çº¯å•å…ƒæµ‹è¯•**ï¼Œä¸“æ³¨äºéªŒè¯è£…é¥°å™¨ç³»ç»Ÿã€å‘½åè§„åˆ™å’Œ TypeScript å…¼å®¹æ€§ã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡

- âœ… ç¡®ä¿ TypeScript 4.x å’Œ 5.x è£…é¥°å™¨å…¼å®¹æ€§
- âœ… éªŒè¯è£…é¥°å™¨å…ƒæ•°æ®æ­£ç¡®ä¿å­˜å’Œè¯»å–
- âœ… æ£€æŸ¥å‘½åè§„åˆ™ä¸ CLI ç”Ÿæˆé€»è¾‘çš„ä¸€è‡´æ€§
- âœ… æµ‹è¯•é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
- âœ… éªŒè¯æµè§ˆå™¨å’Œ Node.js ç¯å¢ƒå…¼å®¹æ€§

> **é›†æˆæµ‹è¯•**: éœ€è¦å¤–éƒ¨ä¾èµ–ï¼ˆå¦‚ `midway-ts-sdk`ï¼‰çš„å®Œæ•´ SDK é›†æˆæµ‹è¯•ä½äº `/midway-ts-sdk-tests/` ç›®å½•ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ index.js                    # æµ‹è¯•å¥—ä»¶æ€»å…¥å£
â”œâ”€â”€ node/                       # Node.js ç¯å¢ƒå•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ index.js               # Node.js æµ‹è¯•å…¥å£
â”‚   â”œâ”€â”€ compatibility.test.js  # TypeScript 5.x å…¼å®¹æ€§æµ‹è¯•
â”‚   â”œâ”€â”€ decorator-basics.test.js # è£…é¥°å™¨åŸºç¡€åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ naming-rules.test.js    # å‘½åè§„åˆ™ä¸€è‡´æ€§æµ‹è¯•
â”‚   â””â”€â”€ function-naming.test.js # å‡½æ•°å‘½åéªŒè¯æµ‹è¯•
â”œâ”€â”€ browser/                    # æµè§ˆå™¨ç¯å¢ƒæµ‹è¯•
â”‚   â”œâ”€â”€ index.html             # æµè§ˆå™¨æµ‹è¯•å…¥å£é¡µé¢
â”‚   â”œâ”€â”€ decorator-browser.test.html # è£…é¥°å™¨æµè§ˆå™¨æµ‹è¯•
â”‚   â””â”€â”€ all-clients.test.html  # æ‰€æœ‰å®¢æˆ·ç«¯æµ‹è¯•
â”œâ”€â”€ decorator-compatibility.test.ts # Jest æ ¼å¼çš„å…¼å®¹æ€§æµ‹è¯•
â””â”€â”€ setup.ts                   # Jest æµ‹è¯•è®¾ç½®
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npm test
```

### åªè¿è¡Œ Node.js æµ‹è¯•
```bash
npm run test:node
```

### è¿è¡Œæµè§ˆå™¨æµ‹è¯•
```bash
npm run test:browser
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# å…¼å®¹æ€§æµ‹è¯•
npm run test:compatibility

# å‘½åè§„åˆ™æµ‹è¯•
npm run test:naming

# å‡½æ•°å‘½åæµ‹è¯•
npm run test:function-naming

# è£…é¥°å™¨åŸºç¡€æµ‹è¯•
npm run test:decorator-basics
```

## ğŸ“‹ æµ‹è¯•è¯¦æƒ…

### Node.js å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | å…³é”®éªŒè¯ç‚¹ |
|----------|----------|------------|
| `compatibility.test.js` | TypeScript ç‰ˆæœ¬å…¼å®¹æ€§ | Legacy/Stage3 è£…é¥°å™¨ã€å…ƒæ•°æ®å­˜å‚¨ã€@RootUri åŠŸèƒ½ |
| `decorator-basics.test.js` | è£…é¥°å™¨åŸºç¡€åŠŸèƒ½ | HTTP æ–¹æ³•è£…é¥°å™¨ã€å…ƒæ•°æ®æ£€ç´¢ã€åŸºæœ¬å…¼å®¹æ€§ |
| `naming-rules.test.js` | å‘½åè§„åˆ™ä¸€è‡´æ€§ | CLI ä¸ shared-rules é€»è¾‘å¯¹æ¯”ã€æ–¹æ³•åç”Ÿæˆ |
| `function-naming.test.js` | å‡½æ•°å‘½åéªŒè¯ | å¤æ‚è·¯å¾„å¤„ç†ã€å‚æ•°é¡ºåºã€è¾¹ç•Œæƒ…å†µ |
| `rooturi-normalization.test.js` | @RootUri è·¯å¾„æ ¼å¼éªŒè¯ | ä¸¥æ ¼è·¯å¾„æ ¼å¼æ£€æŸ¥ã€é”™è¯¯æç¤ºã€è¾¹ç•Œæƒ…å†µ |
| `http-methods-validation.test.js` | HTTP æ–¹æ³•è£…é¥°å™¨è·¯å¾„éªŒè¯ | @GET/@POST/ç­‰è·¯å¾„æ ¼å¼ã€é”™è¯¯æ£€æµ‹ã€å¤æ‚è·¯å¾„ |

### æµè§ˆå™¨æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | éªŒè¯ç¯å¢ƒ |
|----------|----------|----------|
| `decorator-browser.test.html` | æµè§ˆå™¨è£…é¥°å™¨å…¼å®¹æ€§ | ES æ¨¡å—ã€DOM ç¯å¢ƒã€è£…é¥°å™¨å…ƒæ•°æ® |
| `all-clients.test.html` | å®Œæ•´å®¢æˆ·ç«¯åŠŸèƒ½ | ç½‘ç»œè¯·æ±‚ã€UI é›†æˆã€å¤šå®¢æˆ·ç«¯ååŒ |

### å¤–éƒ¨é›†æˆæµ‹è¯•

ä»¥ä¸‹æµ‹è¯•éœ€è¦å¤–éƒ¨ä¾èµ–ï¼Œå·²ç§»è‡³ç‹¬ç«‹é¡¹ç›®ï¼š

| æµ‹è¯•ç±»å‹ | ä½ç½® | ä¾èµ– |
|----------|------|------|
| SDK å®Œæ•´åŠŸèƒ½ | `/midway-ts-sdk-tests/` | `midway-ts-sdk` |
| Request/Response éªŒè¯ | `/midway-ts-sdk-tests/` | ç”Ÿæˆçš„ SDK ç±»å‹ |
| ç«¯åˆ°ç«¯é›†æˆ | `/midway-ts-sdk-tests/` | HTTP æœåŠ¡å™¨ |

## ğŸ”§ å¼€å‘è€…æŒ‡å—

### ç¼–å†™æ–°æµ‹è¯•

#### 1. Node.js å•å…ƒæµ‹è¯•

```javascript
// node/my-feature.test.js
console.log('ğŸ§ª æµ‹è¯•ï¼šæˆ‘çš„æ–°åŠŸèƒ½');

// å¯¼å…¥éœ€è¦æµ‹è¯•çš„æ¨¡å—
const { MyFeature } = require('../../dist/cjs/index.js');

try {
  // æµ‹è¯•ç”¨ä¾‹ 1
  console.log('  âœ… æµ‹è¯•ç”¨ä¾‹ 1: åŸºæœ¬åŠŸèƒ½');
  
  // æµ‹è¯•ç”¨ä¾‹ 2  
  console.log('  âœ… æµ‹è¯•ç”¨ä¾‹ 2: è¾¹ç•Œæƒ…å†µ');
  
  console.log('âœ… æˆ‘çš„æ–°åŠŸèƒ½æµ‹è¯•é€šè¿‡');
} catch (error) {
  console.error('âŒ æµ‹è¯•å¤±è´¥:', error.message);
  process.exit(1);
}
```

ç„¶ååœ¨ `node/index.js` ä¸­æ·»åŠ ï¼š
```javascript
require('./my-feature.test.js');
```

#### 2. æµè§ˆå™¨æµ‹è¯•

```html
<!-- browser/my-feature.test.html -->
<!DOCTYPE html>
<html>
<head>
    <title>æˆ‘çš„æ–°åŠŸèƒ½ - æµè§ˆå™¨æµ‹è¯•</title>
</head>
<body>
    <script type="module">
        import { MyFeature } from '../dist/esm/index.js';
        
        console.log('ğŸ§ª æµè§ˆå™¨æµ‹è¯•ï¼šæˆ‘çš„æ–°åŠŸèƒ½');
        // æµ‹è¯•é€»è¾‘...
    </script>
</body>
</html>
```

### æµ‹è¯•æœ€ä½³å®è·µ

#### å‘½åçº¦å®š

| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|------|----------|------|
| Node.js æµ‹è¯• | `feature-name.test.js` | `decorator-basics.test.js` |
| æµè§ˆå™¨æµ‹è¯• | `feature-name.test.html` | `decorator-browser.test.html` |
| æµ‹è¯•æè¿° | `ğŸ§ª æµ‹è¯•ï¼šåŠŸèƒ½æè¿°` | `ğŸ§ª æµ‹è¯•ï¼šTypeScript 5.x å…¼å®¹æ€§` |

#### é”™è¯¯å¤„ç†

```javascript
// å¥½çš„é”™è¯¯å¤„ç†ç¤ºä¾‹
try {
  const result = someOperation();
  console.log('  âœ… æœŸæœ›ç»“æœ:', expectedValue);
  console.log('  ğŸ“Š å®é™…ç»“æœ:', result);
  
  if (result !== expectedValue) {
    throw new Error(`æœŸæœ› ${expectedValue}ï¼Œä½†å¾—åˆ° ${result}`);
  }
} catch (error) {
  console.error('  âŒ å¤±è´¥åŸå› :', error.message);
  process.exit(1);
}
```

#### æµ‹è¯•éš”ç¦»

- âœ… æ¯ä¸ªæµ‹è¯•æ–‡ä»¶ç‹¬ç«‹è¿è¡Œ
- âœ… ä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„çŠ¶æ€
- âœ… æ¸…ç†å…¨å±€çŠ¶æ€å˜åŒ–
- âœ… ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯¼å…¥

## ğŸš€ è°ƒè¯•å’Œæ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è£…é¥°å™¨å…ƒæ•°æ®ä¸¢å¤±

```javascript
// é—®é¢˜ï¼šè£…é¥°å™¨å…ƒæ•°æ®æœªä¿å­˜
// è§£å†³ï¼šæ£€æŸ¥ tsconfig.json é…ç½®
{
  "experimentalDecorators": true,
  "emitDecoratorMetadata": true
}
```

#### 2. TypeScript 5.x å…¼å®¹æ€§é—®é¢˜

```javascript
// é—®é¢˜ï¼šæ–°è£…é¥°å™¨è¯­æ³•æŠ¥é”™
// è§£å†³ï¼šç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è£…é¥°å™¨é…ç½®
{
  "useDefineForClassFields": false
}
```

#### 3. æ¨¡å—å¯¼å…¥å¤±è´¥

```javascript
// é—®é¢˜ï¼šCannot find module
// è§£å†³ï¼šå…ˆç¼–è¯‘ï¼Œå†è¿è¡Œæµ‹è¯•
npm run build
npm test
```

### æ€§èƒ½ç›‘æ§

è¿è¡Œæµ‹è¯•æ—¶ä¼šæ˜¾ç¤ºæ€§èƒ½æŒ‡æ ‡ï¼š

```bash
ğŸ§ª æµ‹è¯•ï¼šTypeScript 5.x å…¼å®¹æ€§
  ğŸ“Š è£…é¥°å™¨åº”ç”¨è€—æ—¶: 2ms
  ğŸ“Š å…ƒæ•°æ®æ£€ç´¢è€—æ—¶: 1ms
  ğŸ“Š éªŒè¯æ£€æŸ¥è€—æ—¶: 3ms
âœ… å…¼å®¹æ€§æµ‹è¯•é€šè¿‡ (æ€»è€—æ—¶: 6ms)
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

å½“å‰æµ‹è¯•è¦†ç›–ç‡ï¼š

| åŠŸèƒ½æ¨¡å— | è¦†ç›–ç‡ | æµ‹è¯•æ•°é‡ |
|----------|--------|----------|
| è£…é¥°å™¨åŸºç¡€ | 100% | 12 é¡¹ |
| å‘½åè§„åˆ™ | 100% | 8 é¡¹ |
| TypeScript å…¼å®¹æ€§ | 100% | 6 é¡¹ |
| é”™è¯¯å¤„ç† | 95% | 10 é¡¹ |
| æµè§ˆå™¨å…¼å®¹æ€§ | 90% | 4 é¡¹ |

**æ€»è®¡**: 40 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ97% è¦†ç›–ç‡
